<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FarmerVoice ‚Äì Smart Kisan Assistant</title>

<style>
body{
  margin:0;
  font-family:Arial, sans-serif;
  background:linear-gradient(135deg,#e8f5e9,#e3f2fd);
}
header{
  background:#fff;
  padding:12px 18px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  box-shadow:0 2px 8px rgba(0,0,0,.1);
}
h1{font-size:20px;color:#2e7d32;margin:0;}
#location{background:#0288d1;color:#fff;padding:5px 12px;border-radius:15px;font-size:14px;}

main{max-width:720px;margin:auto;padding:20px;text-align:center;}

.card{
  background:#fff;
  border-radius:14px;
  padding:20px;
  margin-bottom:20px;
  box-shadow:0 4px 12px rgba(0,0,0,.08);
}
#status{font-size:18px;font-weight:bold;margin-bottom:6px;}

.mic{
  width:90px;height:90px;border-radius:50%;
  background:linear-gradient(135deg,#2e7d32,#0288d1);
  border:none;color:white;font-size:36px;
  cursor:pointer;
  box-shadow:0 5px 18px rgba(0,0,0,.3);
}

.grid{
  display:grid;
  grid-template-columns:repeat(5,1fr);
  gap:10px;
  margin:15px 0;
}
.grid button{
  border:none;
  background:#fff;
  padding:12px;
  border-radius:10px;
  cursor:pointer;
  box-shadow:0 2px 6px rgba(0,0,0,.1);
  font-weight:bold;
}

.lang-switch button{
  margin:0 5px;
  padding:6px 12px;
  border:none;
  border-radius:6px;
  cursor:pointer;
  background:#0288d1;
  color:#fff;
}

footer{
  text-align:center;
  padding:12px;
  font-size:12px;
  color:#666;
}
</style>
</head>

<body>

<header>
  <h1>FarmerVoice üåæ</h1>
  <div id="location">Detecting‚Ä¶</div>
</header>

<main>

<div class="lang-switch">
  <b>Language:</b>
  <button onclick="setLang('te-IN')">‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å</button>
  <button onclick="setLang('hi-IN')">‡§π‡§ø‡§Ç‡§¶‡•Ä</button>
</div>

<div class="card">
  <div id="status">Loading‚Ä¶</div>
</div>

<button class="mic" id="mic">üé§</button>

<div class="grid">
  <button onclick="showInfo('crop')">Crop</button>
  <button onclick="showInfo('water')">Water</button>
  <button onclick="showInfo('weather')">Weather</button>
  <button onclick="showInfo('market')">Market</button>
  <button onclick="showInfo('news')">News</button>
</div>

</main>

<footer>Hackathon MVP ‚Äì FarmerVoice</footer>

<script>
let lang = "hi-IN";
let selectedVoice = null;

const data = {
  "te-IN": {
    welcome:"‡∞∞‡±à‡∞§‡±Å ‡∞µ‡∞æ‡∞Ø‡∞ø‡∞∏‡±ç‚Äå‡∞ï‡±Å ‡∞∏‡±ç‡∞µ‡∞æ‡∞ó‡∞§‡∞Ç",
    crop:"‡∞à ‡∞∏‡±Ä‡∞ú‡∞®‡±ç‚Äå‡∞ï‡±Å ‡∞µ‡∞∞‡∞ø ‡∞Æ‡∞∞‡∞ø‡∞Ø‡±Å ‡∞™‡±ç‡∞∞‡∞§‡±ç‡∞§‡∞ø ‡∞Æ‡∞Ç‡∞ö‡∞ø ‡∞™‡∞Ç‡∞ü‡∞≤‡±Å.",
    water:"‡∞≠‡±Ç‡∞ó‡∞∞‡±ç‡∞≠ ‡∞ú‡∞≤ ‡∞∏‡±ç‡∞•‡∞æ‡∞Ø‡∞ø ‡∞Æ‡∞ß‡±ç‡∞Ø‡∞Æ‡∞Ç‡∞ó‡∞æ ‡∞â‡∞Ç‡∞¶‡∞ø.",
    weather:"‡∞à ‡∞∞‡±ã‡∞ú‡±Å ‡∞µ‡∞æ‡∞§‡∞æ‡∞µ‡∞∞‡∞£‡∞Ç ‡∞Æ‡±ã‡∞∏‡±ç‡∞§‡∞∞‡±Å ‡∞é‡∞Ç‡∞°‡∞ó‡∞æ ‡∞â‡∞Ç‡∞¶‡∞ø.",
    market:"‡∞ü‡∞Æ‡∞æ‡∞ü ‡∞ß‡∞∞ ‡∞ï‡∞ø‡∞≤‡±ã‡∞ï‡±Å 25 ‡∞∞‡±Ç‡∞™‡∞æ‡∞Ø‡∞≤‡±Å.",
    news:"‡∞∞‡±à‡∞§‡±Å‡∞≤ ‡∞ï‡±ã‡∞∏‡∞Ç ‡∞ï‡±ä‡∞§‡±ç‡∞§ ‡∞™‡±ç‡∞∞‡∞≠‡±Å‡∞§‡±ç‡∞µ ‡∞™‡∞•‡∞ï‡∞Ç ‡∞™‡±ç‡∞∞‡∞æ‡∞∞‡∞Ç‡∞≠‡∞Æ‡±à‡∞Ç‡∞¶‡∞ø."
  },
  "hi-IN": {
    welcome:"‡§´‡§æ‡§∞‡•ç‡§Æ‡§∞ ‡§µ‡•â‡§á‡§∏ ‡§Æ‡•á‡§Ç ‡§Ü‡§™‡§ï‡§æ ‡§∏‡•ç‡§µ‡§æ‡§ó‡§§ ‡§π‡•à",
    crop:"‡§á‡§∏ ‡§Æ‡•å‡§∏‡§Æ ‡§Æ‡•á‡§Ç ‡§ß‡§æ‡§® ‡§î‡§∞ ‡§ï‡§™‡§æ‡§∏ ‡§Ö‡§ö‡•ç‡§õ‡•Ä ‡§´‡§∏‡§≤‡•á‡§Ç ‡§π‡•à‡§Ç.",
    water:"‡§≠‡•Ç‡§ú‡§≤ ‡§∏‡•ç‡§§‡§∞ ‡§Æ‡§ß‡•ç‡§Ø‡§Æ ‡§π‡•à.",
    weather:"‡§Ü‡§ú ‡§Æ‡•å‡§∏‡§Æ ‡§∏‡§æ‡§Æ‡§æ‡§®‡•ç‡§Ø ‡§π‡•à.",
    market:"‡§ü‡§Æ‡§æ‡§ü‡§∞ 25 ‡§∞‡•Å‡§™‡§Ø‡•á ‡§™‡•ç‡§∞‡§§‡§ø ‡§ï‡§ø‡§≤‡•ã.",
    news:"‡§ï‡§ø‡§∏‡§æ‡§®‡•ã‡§Ç ‡§ï‡•á ‡§≤‡§ø‡§è ‡§®‡§à ‡§∏‡§∞‡§ï‡§æ‡§∞‡•Ä ‡§Ø‡•ã‡§ú‡§®‡§æ ‡§∂‡•Å‡§∞‡•Ç ‡§π‡•Å‡§à ‡§π‡•à."
  }
};

/* -------- VOICE HANDLING (FINAL & STABLE) -------- */

function loadVoice(){
  const voices = speechSynthesis.getVoices();

  // Try exact language voice
  selectedVoice = voices.find(v => v.lang === lang);

  // Try similar language
  if(!selectedVoice){
    selectedVoice = voices.find(v =>
      v.lang.startsWith(lang.split("-")[0])
    );
  }

  // Absolute fallback
  if(!selectedVoice){
    selectedVoice = voices[0];
  }
}

speechSynthesis.onvoiceschanged = loadVoice;

function speak(text){
  speechSynthesis.cancel();
  const u = new SpeechSynthesisUtterance(text);
  u.lang = lang;
  if(selectedVoice) u.voice = selectedVoice;
  speechSynthesis.speak(u);
}

/* -------- UI ACTIONS -------- */

function showInfo(type){
  document.getElementById("status").innerText = data[lang][type];
  speak(data[lang][type]);
}

function setLang(l){
  lang = l;
  loadVoice();
  document.getElementById("status").innerText = data[lang].welcome;
  speak(data[lang].welcome);
}

/* -------- VOICE COMMANDS (TELUGU + HINDI) -------- */

document.getElementById("mic").onclick = () => {
  const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
  if(!SR) return alert("Voice not supported");

  const rec = new SR();
  rec.lang = lang;

  rec.onresult = e => {
    const t = e.results[0][0].transcript.toLowerCase();

    if(lang === "te-IN"){
      if(t.includes("‡∞™‡∞Ç‡∞ü")) showInfo("crop");
      else if(t.includes("‡∞®‡±Ä‡∞∞‡±Å")) showInfo("water");
      else if(t.includes("‡∞µ‡∞æ‡∞§‡∞æ‡∞µ‡∞∞‡∞£‡∞Ç")) showInfo("weather");
      else if(t.includes("‡∞ß‡∞∞")) showInfo("market");
      else if(t.includes("‡∞µ‡∞æ‡∞∞‡±ç‡∞§")) showInfo("news");
      else speak("‡∞™‡∞Ç‡∞ü, ‡∞®‡±Ä‡∞∞‡±Å ‡∞≤‡±á‡∞¶‡∞æ ‡∞µ‡∞æ‡∞§‡∞æ‡∞µ‡∞∞‡∞£‡∞Ç ‡∞Ö‡∞®‡∞ø ‡∞ö‡±Ü‡∞™‡±ç‡∞™‡∞Ç‡∞°‡∞ø");
    }
    else{
      if(t.includes("‡§´‡§∏‡§≤")) showInfo("crop");
      else if(t.includes("‡§™‡§æ‡§®‡•Ä")) showInfo("water");
      else if(t.includes("‡§Æ‡•å‡§∏‡§Æ")) showInfo("weather");
      else if(t.includes("‡§¨‡§æ‡§ú‡§æ‡§∞")) showInfo("market");
      else if(t.includes("‡§∏‡§Æ‡§æ‡§ö‡§æ‡§∞")) showInfo("news");
      else speak("‡§ï‡•É‡§™‡§Ø‡§æ ‡§´‡§∏‡§≤, ‡§™‡§æ‡§®‡•Ä ‡§Ø‡§æ ‡§Æ‡•å‡§∏‡§Æ ‡§ï‡§π‡•á‡§Ç");
    }
  };

  rec.start();
};

/* -------- LOCATION -------- */

navigator.geolocation.getCurrentPosition(async p=>{
  const res = await fetch(
    `https://nominatim.openstreetmap.org/reverse?format=json&lat=${p.coords.latitude}&lon=${p.coords.longitude}`
  );
  const geo = await res.json();
  const state = geo.address.state || "India";
  document.getElementById("location").innerText = state;

  if(state.toLowerCase().includes("andhra") || state.toLowerCase().includes("telangana")){
    lang = "te-IN";
  } else {
    lang = "hi-IN";
  }

  loadVoice();
  document.getElementById("status").innerText = data[lang].welcome;
  speak(data[lang].welcome);
});
</script>

</body>
</html>
